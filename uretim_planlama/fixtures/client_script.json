[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Purchase Receipt",
  "enabled": 1,
  "module": "Uretim Planlama",
  "name": "Purchase Receipt Profile Handler",
  "script": "function calculateProfileQty(frm, cdt, cdn) {\n    const row = locals[cdt][cdn];\n    \n    if (!row.custom_is_profile) {\n        frappe.msgprint('Önce \"Profil mi?\" alanını işaretleyin!');\n        return;\n    }\n    \n    if (!row.custom_profile_length_m || !row.custom_profile_length_qty) {\n        frappe.msgprint('Profil boyu ve adedi girilmelidir!');\n        return;\n    }\n    \n    frappe.call({\n        method: 'frappe.client.get_list',\n        args: {\n            doctype: 'Boy',\n            filters: {'name': row.custom_profile_length_m},\n            fields: ['name', 'length'],\n            limit: 1\n        },\n        callback: function(r) {\n            if (!r.message || r.message.length === 0) {\n                frappe.msgprint(`Boy kaydı bulunamadı: ${row.custom_profile_length_m}`);\n                return;\n            }\n            \n            const boy_data = r.message[0];\n            const length = parseFloat(boy_data.length.toString().replace(',', '.'));\n            const qty = parseInt(row.custom_profile_length_qty);\n            const cf = parseFloat(row.conversion_factor) || 1;\n            const calculatedQty = (length * qty) / cf;\n            \n            frappe.model.set_value(cdt, cdn, 'qty', calculatedQty).then(() => {\n                frappe.model.set_value(cdt, cdn, 'stock_qty', calculatedQty * cf);\n                frappe.show_alert(`Hesaplandı: ${length}m × ${qty} = ${calculatedQty.toFixed(2)}`);\n                frm.refresh_field('items');\n            });\n        }\n    });\n}\n\nfunction styleProfileButtons() {\n    setTimeout(() => {\n        $('button[data-fieldname=\"custom_calculate_profile_qty\"]').css({\n            'background-color': '#dc3545',\n            'color': 'white'\n        });\n    }, 500);\n}\n\nfrappe.ui.form.on('Purchase Receipt Item', {\n    custom_calculate_profile_qty: (frm, cdt, cdn) => calculateProfileQty(frm, cdt, cdn)\n});\n\nfrappe.ui.form.on('Purchase Receipt', {\n    refresh: (frm) => styleProfileButtons()\n});",
  "view": "Form"
 }
]